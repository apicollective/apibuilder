{
  "name": "psql-apibuilder",

  "models": {
    "generator_invocation": {
      "fields": [
        {
          "name": "id",
          "type": "string"
        },
        {
          "name": "key",
          "type": "string"
        }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "package": "db.generated",
            "dao_user_class": "java.util.UUID",
            "id_generator": {
              "prefix": "gni"
            }
          }
        },
        {
          "name": "psql",
          "value": {
            "pkey": "id"
          }
        }
      ]
    },

    "migration": {
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "version_guid", "type": "uuid" },
        { "name": "num_attempts", "type": "long", "minimum": 0 },
        { "name": "errors", "type": "[string]", "required": false }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "package": "db.generated",
            "dao_user_class": "java.util.UUID",
            "order_by": { "optional": true },
            "id_generator": {
              "class": "util.IdGenerator"
            }
          }
        },
        {
          "name": "psql",
          "value": {
            "pkey": "id",
            "authorization": { "type": "disabled" },
            "indexes": [
              { "fields":  ["version_guid"] },
              { "fields":  ["num_attempts", "created_at"] }
            ],
            "foreign_keys": [
              {
                "fields": ["version_guid"],
                "references": "versions"
              }
            ]
          }
        }
      ]
    },

    "task": {
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "type", "type": "string" },
        { "name": "type_id", "type": "string" },
        { "name": "organization_guid", "type": "uuid", "required": false },
        { "name": "num_attempts", "type": "integer", "minimum": 0, "default": 0 },
        { "name": "next_attempt_at", "type": "date-time-iso8601" },
        { "name": "errors", "type": "[string]", "required": false },
        { "name": "stacktrace", "type": "string", "required": false },
        { "name": "data", "type": "json" }
      ],
      "attributes": [
        {
          "name": "scala",
          "value": {
            "package": "db.generated",
            "dao_user_class": "java.util.UUID",
            "order_by": { "optional": true }
          }
        },
        {
          "name": "psql",
          "value": {
            "pkey": "id",
            "authorization": { "type": "disabled" },
            "on_conflict": {
              "fields": ["type_id", "type"]
            },
            "indexes": [
              { "fields": ["num_attempts", "next_attempt_at"] }
            ]
          }
        }
      ]
    }
  }
}
