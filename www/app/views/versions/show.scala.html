@(tpl: models.MainTemplate,
  application: com.gilt.apidoc.models.Application,
  service: com.gilt.apidoc.spec.models.Service,
  isWatching: Boolean
)(implicit flash: Flash)

@main(tpl) {

  <div class="pull-right">
    @if(tpl.isOrgMember) {
      <a href="@routes.Versions.create(orgKey = tpl.org.get.key, application = Some(service.application.key))">Upload new version</a> |
    }

    @if(isWatching) {
      <a class="postForm" href="@routes.Versions.postWatch(orgKey = service.organization.key, applicationKey = service.application.key, version = service.version)">Watching</a>
    } else {
      <a class="postForm" href="@routes.Versions.postWatch(orgKey = service.organization.key, applicationKey = service.application.key, version = service.version)">Not Watching</a>
    }
  </div>
 
  <div class="pull-left">
    @service.description.getOrElse("")

    <h2>Resources</h2>
    @service.resources.map { resource =>
      <div id="resource-@lib.UrlKey.generate(resource.model.name)"></div>
      <a name="resource-@lib.UrlKey.generate(resource.model.name)"></a>
      <div class="version_resource">
        <h3><a href="#model-@lib.UrlKey.generate(resource.model.name)">@resource.model.name</a></h3>

        @resource.description.getOrElse("")

        <h4>Operations</h4>
        @if(resource.operations.isEmpty) {
          <em>No operations</em>
        } else {
          <table class="table table-hover table-condensed">
            <thead>
              <tr>
                <th colspan="2">Method and Path</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
             @resource.operations.zipWithIndex.map { case(operation, index) =>
               <tr>
                 <td class="nowrap"><a onClick="$('#operation-@lib.UrlKey.generate(resource.model.name)-@index').toggle()">@operation.method</a></td>
                 <td class="nowrap"><a onClick="$('#operation-@lib.UrlKey.generate(resource.model.name)-@index').toggle()">@operation.path</a></td>
                 <td>@operation.description.getOrElse("")</td>
               </tr>
               <tr id="operation-@lib.UrlKey.generate(resource.model.name)-@index" style="display:none">
                 <td></td>
                 <td colspan="2">
                   @operation.method @service.baseUrl@operation.path

                   @operation.body.map { b =>
                     <h4>Body</h4>
                     @body(tpl.org.get, application, tpl.version.get, service, b)
                   }

                   <h4>Parameters</h4>
                   @if(operation.parameters.isEmpty) {
                     <em>No parameters</em>
                   } else {
                     @parameters(tpl.org.get, application, tpl.version.get, service, operation)
                   }

                   <h4>Response</h4>
                   @operation.responses.map { response =>
                     <p>
                       HTTP @response.code:
                       @datatype(tpl.org.get, application, tpl.version.get, service, response.`type`)
                     </p>
                   }
                 </td>

               </tr>
             }
            </tbody>
          </table>
        }

      </div>
    }

    <h2>Headers</h2>
    @if(service.headers.isEmpty) {
      <em>No headers</em>
    } else {
      @headers(tpl.org.get, application, tpl.version.get, service, service.headers)
    }

    <h2>Imports</h2>
    @if(service.imports.isEmpty) {
      <em>No imports</em>
    } else {
      @imports(service.imports)
    }

    <h2>Enums</h2>
    @if(service.enums.isEmpty) {
      <em>None</em>
    } else {
      @service.enums.map { enum =>
        <div id="enum-@lib.UrlKey.generate(enum.name)"></div>
        <a name="enum-@lib.UrlKey.generate(enum.name)"></a>
        <div class="version_model">
          <h3>@enum.name</h3>

          @enum.description.getOrElse("")

          @values(tpl.org.get, application, tpl.version.get, enum)
        </div>
      }
    }

    <h2>Models</h2>
    @if(service.models.isEmpty) {
      <em>None</em>
    } else {
      @service.models.map { model =>
        <div id="model-@lib.UrlKey.generate(model.name)"></div>
        <a name="model-@lib.UrlKey.generate(model.name)"></a>
        <div class="version_model">
          <h3>@model.name</h3>

          @model.description.getOrElse("")

          @fields(tpl.org.get, application, tpl.version.get, service, model.fields)
        </div>
      }
    </div>
  }

}
